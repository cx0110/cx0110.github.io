---
authors:
- 1ch0
date: 2022-01-11 00:00:00
image:
  filename: python-logo.svg
tags:
- Kubernetes
title: K8S-M-20220109-day2
---

 20220109-day2
## 1. äº‘åŸç”Ÿ

```shell
cat /etc/system/system/apiserver.service
```

kubeproxy é…ç½®ä¿®æ”¹
cat /etc/systmd/system/kube-proxy.service é‡Œçš„--config å‚æ•°


## coredns
- æœåŠ¡å‘ç°

## etcd
```shell
etcdctl member list

etcdctl endpoint health
--write-out=table
endpoint status

ETCDCTL_API=3 etcdctl get / --prefix --keys-only #ä»¥è·¯å¾„çš„æ–¹å¼æ˜¾ç¤ºæ‰€æœ‰çš„ key
|grep deploy
|grep namespace
|grep service

etcdctl get xxx
ETCDCTL_API=3 etcdctl get /name
ETCDCTL_API=3 etcdctl put /name "demo"
ETCDCTL_API=3 etcdctl del /name
ETCDCTL_API=3 etcdctl watch /data


ETCDCTL_API=2 etcdctl --help
```
#### å¤‡ä»½æ¢å¤
WAL   write ahead log
```shell
ETCDCTL_API=3 etcdctl snapshot save snapshot.db # é»˜è®¤åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºå¤‡ä»½æ–‡ä»¶
ETCDCTL_API=3 etcdctl snapshot restore å¤‡ä»½æ–‡ä»¶ --data-dir=/var/lib/etcd # è¦æ±‚æ¢å¤ç›®å½•ä¸å­˜åœ¨

```

æ¢å¤ï¼š
- åœæ­¢ etcd
- ç§»èµ° etcd ç›®å½•
- æ¢å¤

kubeasz

### ETCD æ•°æ®æ¢å¤æµç¨‹

ezctl


kubeadm ä¿®æ”¹è¯ä¹¦æ—¶é—´ï¼Œè¯ä¹¦è¿‡æœŸç»­ç­¾é—®é¢˜æ¯”è¾ƒå¤šã€‚

### åˆ é™¤èŠ‚ç‚¹
- pod é©±é€  kubectl drain pod
- åˆ é™¤ node

### å‡çº§
ä¸èƒ½è·¨å¤§ç‰ˆæœ¬å‡çº§ï¼Œåªèƒ½å°ç‰ˆæœ¬å‡çº§

kube tab å­˜åœ¨çš„ éƒ½è¦å‡çº§

- å…ˆå‡çº§ master åå‡çº§ node
- master
    - kube-apiserver kube-controller-manager kubectl kubelet kube-proxy kube-scheduler
- å‡çº§ node
    - kubectl kubelet kube-proxy

1. kubectl stop ***    systemctl status kube-lb
2. æ‹·è´æ–°ç‰ˆæœ¬äºŒè¿›åˆ¶æ–‡ä»¶

### yaml
kubectl explain namespace
kubectl explain namespace.kind


```ad-summary
- [ ] ipvs ğŸ”¼ ğŸ›« 2022-01-12 â³ 2022-01-13 ğŸ“… 2022-01-15
```
docker run -d -p 59000:9000 -p 9443:9443 -p 8000:8000 --name portainer \
    --restart=always \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v portainer_data:/data \
    portainer/portainer-ce:2.11.1